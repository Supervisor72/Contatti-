<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report PDV</title>
    <style>
        /* (Stili CSS invariati per brevità) */
    </style>
</head>
<body>
    <div class="container">
        <h1>REPORT PDV</h1>
        <div id="reportDate"></div>

        <div class="header">
            <div class="form-group">
                <label for="colleagueName">PUNTO VENDITA:</label>
                <select id="colleagueName">
                    <option value="">-- Seleziona punto vendita --</option>
                    <option value="FANO">FANO</option>
                    <option value="MONSANO">MONSANO</option>
                    <option value="OSIMO">OSIMO</option>
                    <option value="MACERATA">MACERATA</option>
                    <option value="CIVITANOVA">CIVITANOVA</option>
                    <option value="PESARO">PESARO</option>
                </select>
            </div>
        </div>

        <div id="clientCards"></div>

        <button class="btn" id="addClientBtn">+ Aggiungi Cliente</button>
        <button class="btn btn-secondary" id="sendReportBtn">Invia Report</button>
        <button class="btn" style="background-color:#dc3545" id="resetBtn">Reset Modulo</button>
    </div>

    <script>
        const today = new Date();
        const formattedDate = today.toLocaleDateString('it-IT');
        document.getElementById('reportDate').textContent = `Data: ${formattedDate}`;

        let clientCount = 0;
        const clientsContainer = document.getElementById('clientCards');

        function saveFormData() {
            const formData = {
                colleagueName: document.getElementById('colleagueName').value,
                clientCards: []
            };
            document.querySelectorAll('.client-card').forEach(card => {
                const id = card.id.split('-')[1];
                formData.clientCards.push({
                    addetto: document.getElementById(`addetto-${id}`).value,
                    reparto: document.getElementById(`reparto-${id}`).value,
                    prodotto: document.getElementById(`prodotto-${id}`).value,
                    protocollo: document.getElementById(`protocolloSi-${id}`).checked ? 'SI' : 'NO',
                    vendita: document.getElementById(`venditaSi-${id}`).checked ? 'SI' : 'NO'
                });
            });
            localStorage.setItem('reportPDVData', JSON.stringify(formData));
        }

        function loadFormData() {
            const data = localStorage.getItem('reportPDVData');
            if (!data) return;
            const formData = JSON.parse(data);
            document.getElementById('colleagueName').value = formData.colleagueName;
            formData.clientCards.forEach(client => {
                addClient();
                const id = clientCount;
                document.getElementById(`addetto-${id}`).value = client.addetto;
                document.getElementById(`reparto-${id}`).value = client.reparto;
                document.getElementById(`prodotto-${id}`).value = client.prodotto;
                document.getElementById(`protocolloSi-${id}`).checked = client.protocollo === 'SI';
                document.getElementById(`protocolloNo-${id}`).checked = client.protocollo === 'NO';
                document.getElementById(`venditaSi-${id}`).checked = client.vendita === 'SI';
                document.getElementById(`venditaNo-${id}`).checked = client.vendita === 'NO';
            });
        }

        function resetForm() {
            localStorage.removeItem('reportPDVData');
            document.getElementById('colleagueName').value = '';
            clientsContainer.innerHTML = '';
            clientCount = 0;
            addClient();
        }

        function addClient() {
            clientCount++;
            const clientCard = document.createElement('div');
            clientCard.className = 'client-card';
            clientCard.id = `client-${clientCount}`;
            clientCard.innerHTML = `
                <div class="client-header">
                    <div class="client-number">Cliente N° ${clientCount}</div>
                    <button class="remove-btn" onclick="removeClient(${clientCount})">Rimuovi</button>
                </div>
                <div class="form-group">
                    <label for="addetto-${clientCount}">ADDETTO:</label>
                    <input type="text" id="addetto-${clientCount}" placeholder="Nome addetto">
                </div>
                <div class="form-group">
                    <label for="reparto-${clientCount}">REPARTO/I:</label>
                    <select id="reparto-${clientCount}">
                        <option value="">-- Seleziona reparto --</option>
                        <option value="ISOLA">ISOLA</option>
                        <option value="INFORMATICA">INFORMATICA</option>
                        <option value="BIANCO">BIANCO</option>
                        <option value="CLIMA">CLIMA</option>
                        <option value="PED">PED</option>
                        <option value="TV">TV</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="prodotto-${clientCount}">PRODOTTO:</label>
                    <input type="text" id="prodotto-${clientCount}" placeholder="Prodotto">
                </div>
                <div class="form-group">
                    <label>PROTOCOLLO:</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="protocolloSi-${clientCount}" name="protocollo-${clientCount}" value="SI">
                            <label for="protocolloSi-${clientCount}">SI</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="protocolloNo-${clientCount}" name="protocollo-${clientCount}" value="NO">
                            <label for="protocolloNo-${clientCount}">NO</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>VENDITA:</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="venditaSi-${clientCount}" name="vendita-${clientCount}" value="SI">
                            <label for="venditaSi-${clientCount}">SI</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="venditaNo-${clientCount}" name="vendita-${clientCount}" value="NO">
                            <label for="venditaNo-${clientCount}">NO</label>
                        </div>
                    </div>
                </div>
            `;
            clientsContainer.appendChild(clientCard);
        }

        function removeClient(id) {
            const card = document.getElementById(`client-${id}`);
            if (card) card.remove();
        }

        document.getElementById('addClientBtn').addEventListener('click', () => { addClient(); saveFormData(); });
        document.getElementById('sendReportBtn').addEventListener('click', () => { saveFormData(); sendReport(); });
        document.getElementById('resetBtn').addEventListener('click', resetForm);
        document.getElementById('colleagueName').addEventListener('change', saveFormData);

        window.addEventListener('beforeunload', saveFormData);
        window.onload = () => {
            loadFormData();
            if (clientCount === 0) addClient();
        };

        // sendReport resta invariato (non riscritto qui per brevità)
    </script>
</body>
</html>
